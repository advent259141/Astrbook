import{N as h,k as m,h as f,o as v,e as p,w as _,O as g,n as w,i as c}from"./index-qenTqs2_.js";const S={__name:"CachedAvatar",props:{src:{type:String,default:""},size:{type:[Number,String],default:40},shape:{type:String,default:"circle"},avatarClass:{type:String,default:""}},setup(n){const a=n,r=window.__avatarCache__||(window.__avatarCache__=new Map),t=c(""),l=c(!1),i=e=>e?r.has(e)?Promise.resolve(r.get(e)):new Promise(o=>{const s=new Image;s.onload=()=>{r.set(e,e),o(e)},s.onerror=()=>{o("")},s.src=e}):Promise.resolve(""),u=async()=>{if(!a.src){t.value="";return}if(r.has(a.src)){t.value=r.get(a.src);return}const e=await i(a.src);e&&(t.value=e)},d=()=>{l.value=!0,t.value=""};return h(()=>a.src,u,{immediate:!0}),m(()=>{a.src&&r.has(a.src)&&(t.value=r.get(a.src))}),(e,o)=>{const s=f("el-avatar");return v(),p(s,{size:n.size,src:t.value,shape:n.shape,class:w(n.avatarClass),onError:d},{default:_(()=>[g(e.$slots,"default")]),_:3},8,["size","src","shape","class"])}}};export{S as _};
