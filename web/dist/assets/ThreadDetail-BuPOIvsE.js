import{o as l,c as n,a as t,b as r,w as _,q as O,E as Q,d as h,t as a,p,G as W,e as M,F as y,m as x,H as X,I as Z,J as ee,h as d,i as c,B as te,L as ae,ak as se,D as oe,M as le}from"./index-qenTqs2_.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"thread-detail"},ce={class:"page-title"},ie={key:0,class:"card thread-card"},ue={key:1,class:"card thread-card"},de={class:"thread-title"},_e={class:"thread-meta"},pe={class:"author-name"},ve={class:"time"},he={class:"reply-count"},me={class:"floor first-floor"},ge={class:"floor-content"},fe={class:"card replies-card","element-loading-background":"rgba(0, 0, 0, 0)"},ke={class:"replies-title"},ye={class:"floor-header"},be={class:"floor-left"},we={class:"author-name"},Ce={class:"floor-num"},De={class:"floor-time"},Re={class:"floor-content"},Te={key:0,class:"sub-replies"},xe={class:"sub-author"},ze={key:0,class:"reply-to"},Ve={class:"reply-to-name"},Pe={class:"sub-content"},Se={key:0,class:"view-more"},Be={key:1,class:"pagination-wrapper"},Fe={class:"sub-reply-list"},Ne={class:"sub-reply-header"},Ye={class:"sub-author"},He={key:0,class:"reply-to"},Ie={class:"sub-time"},Le={class:"sub-content"},Me={key:0,class:"sub-pagination"},b=20,Ue={__name:"ThreadDetail",setup(Ee){const U=le(),w=oe(()=>U.params.id),i=c(null),g=c([]),v=c(!0),f=c(1),z=c(0),V=c(0),C=c(!1),D=c(null),P=c([]),k=c(1),S=c(0),B=c(0),R=s=>te(s).format("YYYY-MM-DD HH:mm"),F=s=>{i.value=s.thread,g.value=s.replies.items||[],z.value=s.replies.total||0,V.value=s.replies.total_pages||0},N=async(s={})=>{if(!((s==null?void 0:s.force)===!0)){const u=X(w.value,f.value,b);if(u){F(u),v.value=!1;return}}v.value=!0;try{const u=await Z(w.value,{page:f.value,page_size:b});F(ee(w.value,f.value,b,u))}catch(u){console.error("Failed to load thread:",u)}finally{v.value=!1}},E=()=>{N()},$=async s=>{D.value=s,k.value=1,await Y(),C.value=!0},Y=async()=>{try{const s=await se(D.value.id,{page:k.value,page_size:20});P.value=s.items||[],S.value=s.total||0,B.value=s.total_pages||0}catch(s){console.error("Failed to load sub replies:",s)}};return N(),(s,o)=>{var L;const u=d("el-button"),j=d("router-link"),H=d("el-skeleton"),T=d("el-avatar"),q=d("ChatDotRound"),G=d("el-icon"),J=d("el-empty"),I=d("el-pagination"),A=d("el-dialog"),K=ae("loading");return l(),n("div",re,[t("div",ce,[r(j,{to:"/admin/threads"},{default:_(()=>[r(u,{icon:O(Q),text:""},{default:_(()=>[...o[3]||(o[3]=[h("返回",-1)])]),_:1},8,["icon"])]),_:1})]),v.value&&!i.value?(l(),n("div",ie,[r(H,{rows:10,animated:""})])):i.value?(l(),n("div",ue,[t("h1",de,a(i.value.title),1),t("div",_e,[r(T,{size:32,src:i.value.author.avatar},{default:_(()=>[h(a(i.value.author.nickname[0]),1)]),_:1},8,["src"]),t("span",pe,a(i.value.author.nickname),1),o[4]||(o[4]=t("span",{class:"meta-divider"},"·",-1)),t("span",ve,a(R(i.value.created_at)),1),o[5]||(o[5]=t("span",{class:"meta-divider"},"·",-1)),t("span",he,a(i.value.reply_count)+" 条回复",1)]),t("div",me,[o[6]||(o[6]=t("div",{class:"floor-header"},[t("span",{class:"floor-num"},"1楼"),t("span",{class:"floor-tag op"},"楼主")],-1)),t("div",ge,a(i.value.content),1)])])):p("",!0),W((l(),n("div",fe,[t("h3",ke,[r(G,null,{default:_(()=>[r(q)]),_:1}),o[7]||(o[7]=h(" 全部回复",-1))]),v.value&&g.value.length===0?(l(),M(H,{key:0,rows:10,animated:""})):(l(),n(y,{key:1},[(l(!0),n(y,null,x(g.value,e=>(l(),n("div",{key:e.id,class:"floor"},[t("div",ye,[t("div",be,[r(T,{size:28,src:e.author.avatar},{default:_(()=>[h(a(e.author.nickname[0]),1)]),_:2},1032,["src"]),t("span",we,a(e.author.nickname),1),t("span",Ce,a(e.floor_num)+"楼",1)]),t("span",De,a(R(e.created_at)),1)]),t("div",Re,a(e.content),1),e.sub_replies.length>0?(l(),n("div",Te,[(l(!0),n(y,null,x(e.sub_replies,m=>(l(),n("div",{key:m.id,class:"sub-reply"},[t("span",xe,a(m.author.nickname),1),m.reply_to?(l(),n("span",ze,[o[8]||(o[8]=h(" 回复 ",-1)),t("span",Ve,a(m.reply_to.nickname),1)])):p("",!0),t("span",Pe,": "+a(m.content),1)]))),128)),e.sub_reply_count>e.sub_replies.length?(l(),n("div",Se,[r(u,{text:"",type:"primary",size:"small",onClick:m=>$(e)},{default:_(()=>[h(" 查看全部 "+a(e.sub_reply_count)+" 条回复 ",1)]),_:2},1032,["onClick"])])):p("",!0)])):p("",!0)]))),128)),!v.value&&g.value.length===0?(l(),M(J,{key:0,description:"暂无回复"})):p("",!0),V.value>1?(l(),n("div",Be,[r(I,{"current-page":f.value,"onUpdate:currentPage":o[0]||(o[0]=e=>f.value=e),total:z.value,"page-size":b,layout:"prev, pager, next",onCurrentChange:E},null,8,["current-page","total"])])):p("",!0)],64))])),[[K,v.value&&g.value.length>0]]),r(A,{modelValue:C.value,"onUpdate:modelValue":o[2]||(o[2]=e=>C.value=e),title:`${(L=D.value)==null?void 0:L.floor_num}楼 的回复`,width:"600px"},{default:_(()=>[t("div",Fe,[(l(!0),n(y,null,x(P.value,e=>(l(),n("div",{key:e.id,class:"sub-reply-item"},[t("div",Ne,[r(T,{size:24,src:e.author.avatar},{default:_(()=>[h(a(e.author.nickname[0]),1)]),_:2},1032,["src"]),t("span",Ye,a(e.author.nickname),1),e.reply_to?(l(),n("span",He," 回复 "+a(e.reply_to.nickname),1)):p("",!0),t("span",Ie,a(R(e.created_at)),1)]),t("div",Le,a(e.content),1)]))),128))]),B.value>1?(l(),n("div",Me,[r(I,{"current-page":k.value,"onUpdate:currentPage":o[1]||(o[1]=e=>k.value=e),total:S.value,"page-size":20,layout:"prev, pager, next",small:"",onCurrentChange:Y},null,8,["current-page","total"])])):p("",!0)]),_:1},8,["modelValue","title"])])}}},qe=ne(Ue,[["__scopeId","data-v-c52b7d28"]]);export{qe as default};
