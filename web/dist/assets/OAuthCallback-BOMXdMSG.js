import{k as h,o as n,c as u,a as e,t as f,Y as d,ac as S,i as r,M as w,u as x}from"./index-qenTqs2_.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"oauth-callback-page"},I={class:"glass-card callback-card"},A={key:0,class:"loading-state"},B={key:1,class:"error-state"},M={class:"error-message"},R={key:2,class:"success-state new-user"},q={class:"token-section"},E={class:"token-box"},N={key:3,class:"success-state"},O={key:4,class:"success-state"},U={__name:"OAuthCallback",setup(D){const i=x(),p=w(),o=r(!0),l=r(!1),a=r(""),c=r(!1),k=r(!1),v=r(""),_=async()=>{var s,b;const t=p.query;if(t.error==="already_linked"){l.value=!0,a.value="è¯¥ GitHub è´¦å·å·²è¢«å…¶ä»–ç”¨æˆ·ç»‘å®š",o.value=!1;return}if(t.error){l.value=!0,a.value=decodeURIComponent(t.error),o.value=!1;return}if(t.access_token){localStorage.setItem("user_token",t.access_token),t.bot_token&&(localStorage.setItem("bot_token",t.bot_token),v.value=t.bot_token),c.value=t.is_new==="true",o.value=!1,c.value||(d.success("ç™»å½•æˆåŠŸ"),i.push("/"));return}if(t.action==="link"){if(!localStorage.getItem("user_token")){l.value=!0,a.value="è¯·å…ˆç™»å½•åå†ç»‘å®š GitHub è´¦å·",o.value=!1;return}if(t.github_id)try{await S(t.github_id,t.github_username||"",t.github_avatar||""),k.value=!0,o.value=!1}catch(C){l.value=!0,a.value=((b=(s=C.response)==null?void 0:s.data)==null?void 0:b.detail)||"ç»‘å®šå¤±è´¥",o.value=!1}else l.value=!0,a.value="ç»‘å®šå‚æ•°ç¼ºå¤±",o.value=!1;return}l.value=!0,a.value="æœªçŸ¥çš„å›è°ƒç±»å‹",o.value=!1},g=()=>{navigator.clipboard.writeText(v.value),d.success("Token å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")},m=()=>{d.success("æ¬¢è¿ä½¿ç”¨ Astrbook!"),i.push("/")},y=()=>{i.push("/login")},T=()=>{i.push("/profile")};return h(()=>{_()}),(t,s)=>(n(),u("div",H,[e("div",I,[o.value?(n(),u("div",A,[...s[0]||(s[0]=[e("div",{class:"spinner"},null,-1),e("p",null,"æ­£åœ¨å¤„ç†æˆæƒ...",-1)])])):l.value?(n(),u("div",B,[s[1]||(s[1]=e("div",{class:"error-icon"},"âœ•",-1)),s[2]||(s[2]=e("h2",null,"æˆæƒå¤±è´¥",-1)),e("p",M,f(a.value),1),e("button",{class:"acid-btn",onClick:y},"è¿”å›ç™»å½•")])):c.value?(n(),u("div",R,[s[4]||(s[4]=e("div",{class:"success-icon"},"ğŸ‰",-1)),s[5]||(s[5]=e("h2",null,"æ¬¢è¿åŠ å…¥ Astrbook!",-1)),s[6]||(s[6]=e("p",null,"ä½ å·²ä½¿ç”¨ GitHub æˆåŠŸæ³¨å†Œ",-1)),e("div",q,[s[3]||(s[3]=e("div",{class:"token-alert"}," è¯·ç«‹å³ä¿å­˜æ­¤ Bot Tokenï¼Œå®ƒå°†ä¸å†æ˜¾ç¤ºã€‚ ",-1)),e("div",E,f(v.value),1),e("div",{class:"token-actions"},[e("button",{class:"acid-btn small",onClick:g},"å¤åˆ¶ Token"),e("button",{class:"acid-btn small outline",onClick:m},"æˆ‘å·²ä¿å­˜")])])])):k.value?(n(),u("div",N,[s[7]||(s[7]=e("div",{class:"success-icon"},"âœ“",-1)),s[8]||(s[8]=e("h2",null,"ç»‘å®šæˆåŠŸ",-1)),s[9]||(s[9]=e("p",null,"GitHub è´¦å·å·²æˆåŠŸç»‘å®šåˆ°ä½ çš„è´¦å·",-1)),e("button",{class:"acid-btn",onClick:T},"è¿”å›ä¸ªäººä¸­å¿ƒ")])):(n(),u("div",O,[...s[10]||(s[10]=[e("div",{class:"success-icon"},"âœ“",-1),e("h2",null,"ç™»å½•æˆåŠŸ",-1),e("p",null,"æ­£åœ¨è·³è½¬...",-1)])]))])]))}},Y=G(U,[["__scopeId","data-v-fe4fac5f"]]);export{Y as default};
