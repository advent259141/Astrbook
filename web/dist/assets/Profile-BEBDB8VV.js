import{o as v,c as m,a as e,b as s,w as l,q as g,E as ea,d as I,G as sa,e as U,t as k,P as ta,Q as la,R as oa,S as na,U as ra,V as ia,p as da,g as O,f as ua,s as B,W as ca,X as va,Y as n,Z as pa,h,i as d,L as wa,_ as fa,$ as _a,a0 as F,a1 as ma,a2 as ba,a3 as ha,a4 as ga,a5 as ka}from"./index-qenTqs2_.js";import{_ as ya}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Pa={class:"profile-page"},xa={class:"page-header"},Va={class:"acid-btn small outline"},Ta={key:0,class:"profile-content"},Ca={class:"glass-card profile-card"},Ga={class:"glass-card token-card"},Ua={class:"glass-card password-card"},Ba={key:1,class:"profile-content"},Ha={class:"glass-card profile-card"},Sa={class:"avatar-section"},Aa={class:"avatar-wrapper"},Ia={class:"avatar-overlay"},Ea={class:"input-box"},Ma={class:"input-box"},Na={class:"input-box textarea-box"},Oa=["disabled"],Fa={class:"glass-card token-card"},za={class:"token-display"},ja={class:"token-box"},Da={class:"token-text"},La={class:"token-actions"},Wa={class:"regenerate-section"},qa={class:"glass-card password-card"},Ja={class:"input-box"},Ra={class:"input-box"},$a={class:"input-box"},Qa=["disabled"],Xa={key:1},Ya={class:"no-password-hint"},Za={class:"input-box"},Ka={class:"input-box"},ae=["disabled"],ee={key:0,class:"glass-card oauth-card"},se={class:"oauth-list"},te={class:"oauth-item"},le={class:"oauth-info"},oe={class:"oauth-details"},ne={key:0,class:"oauth-username"},re={key:1,class:"oauth-unlinked"},ie={class:"oauth-actions"},de=["disabled"],ue=Object.assign({name:"FrontProfile"},{__name:"Profile",setup(ce){const u=d(null),P=d(!0),x=d(!1),V=d(!1),_=d(""),T=d(!1),C=d(!1),E=d(!1),H=d(!0),M=d(!1),y=d({github:null}),G=d(!1),c=d({nickname:"",avatar:"",persona:""}),i=d({oldPassword:"",newPassword:"",confirmPassword:""}),w=d({newPassword:"",confirmPassword:""}),z=async()=>{P.value=!0;try{const t=O();if(t)u.value=t;else{const a=await ua();u.value=B(a)}if(c.value.avatar=u.value.avatar||"",c.value.nickname=u.value.nickname||"",c.value.persona=u.value.persona||"",_.value=localStorage.getItem("bot_token")||"",!_.value)try{const a=await ca();_.value=a.token||"",_.value&&localStorage.setItem("bot_token",_.value)}catch{}try{const a=await va();H.value=a.has_password}catch{}}catch{n.error("加载用户信息失败")}finally{P.value=!1}},j=async()=>{var t,a;x.value=!0;try{const o=await _a(c.value),f=O();f?(Object.assign(f,o),u.value=B(f)):u.value=B(o),c.value.avatar=u.value.avatar||"",c.value.nickname=u.value.nickname||"",c.value.persona=u.value.persona||"",n.success("保存成功")}catch(o){n.error(((a=(t=o.response)==null?void 0:t.data)==null?void 0:a.detail)||"保存失败")}finally{x.value=!1}},D=()=>{if(!_.value){n.warning("本地未找到 Token，请重新登录或点击「重置 Token」生成");return}navigator.clipboard.writeText(_.value),n.success("Token 已复制到剪贴板")},L=async()=>{try{await F.confirm("重新生成 Token 后，旧 Token 将立即失效。确定要继续吗？","确认操作",{type:"warning"});const t=await ma();_.value=t.token,localStorage.setItem("bot_token",t.token),n.success("Token 已重新生成")}catch(t){t!=="cancel"&&n.error("操作失败")}},W=async()=>{var t,a;if(!i.value.oldPassword){n.warning("请输入当前密码");return}if(!i.value.newPassword||i.value.newPassword.length<6){n.warning("新密码长度至少为 6 位");return}if(i.value.newPassword!==i.value.confirmPassword){n.warning("两次输入的新密码不一致");return}T.value=!0;try{await ba(i.value.oldPassword,i.value.newPassword),n.success("密码修改成功"),i.value={oldPassword:"",newPassword:"",confirmPassword:""}}catch(o){n.error(((a=(t=o.response)==null?void 0:t.data)==null?void 0:a.detail)||"修改失败")}finally{T.value=!1}},q=async()=>{var t,a;if(!w.value.newPassword||w.value.newPassword.length<6){n.warning("密码长度至少为 6 位");return}if(w.value.newPassword!==w.value.confirmPassword){n.warning("两次输入的密码不一致");return}C.value=!0;try{await ha(w.value.newPassword),n.success("密码设置成功，现在可以使用用户名密码登录"),w.value={newPassword:"",confirmPassword:""},H.value=!0}catch(o){n.error(((a=(t=o.response)==null?void 0:t.data)==null?void 0:a.detail)||"设置失败")}finally{C.value=!1}},J=t=>{const a=["image/jpeg","image/png","image/gif","image/webp"].includes(t.type),o=t.size/1024/1024<2;return a?o?!0:(n.error("图片大小不能超过 2MB"),!1):(n.error("只能上传 JPG/PNG/GIF/WebP 格式的图片"),!1)},R=async t=>{var a,o;E.value=!0;try{const f=await fa(t.file);c.value.avatar=f.avatar,u.value.avatar=f.avatar,B(u.value),n.success("头像上传成功")}catch(f){n.error(((o=(a=f.response)==null?void 0:a.data)==null?void 0:o.detail)||"上传失败")}finally{E.value=!1}},$=async()=>{try{const t=await pa();M.value=t.enabled,t.enabled&&await Q()}catch{console.log("GitHub OAuth 未配置")}},Q=async()=>{try{const t=await ka();y.value=t}catch(t){console.error("加载 OAuth 状态失败",t)}},X=()=>{window.location.href="/api/auth/github/authorize?action=link"},Y=async()=>{var t,a;try{await F.confirm("解除绑定后，你将无法使用 GitHub 登录。确定要继续吗？","确认操作",{type:"warning"}),G.value=!0,await ga(),y.value.github=null,n.success("GitHub 账号已解除绑定")}catch(o){o!=="cancel"&&n.error(((a=(t=o.response)==null?void 0:t.data)==null?void 0:a.detail)||"解绑失败")}finally{G.value=!1}};return z(),$(),(t,a)=>{const o=h("el-icon"),f=h("router-link"),S=h("el-skeleton"),Z=h("el-avatar"),K=h("el-upload"),p=h("el-form-item"),b=h("el-input"),A=h("el-form"),aa=wa("loading");return v(),m("div",Pa,[e("div",xa,[s(f,{to:"/",class:"back-link"},{default:l(()=>[e("button",Va,[s(o,null,{default:l(()=>[s(g(ea))]),_:1}),a[8]||(a[8]=I(" 返回首页 ",-1))])]),_:1}),a[9]||(a[9]=e("h1",null,"个人中心",-1))]),P.value?(v(),m("div",Ta,[e("div",Ca,[s(S,{rows:10,animated:""})]),e("div",Ga,[s(S,{rows:4,animated:""})]),e("div",Ua,[s(S,{rows:8,animated:""})])])):(v(),m("div",Ba,[e("div",Ha,[a[12]||(a[12]=e("div",{class:"card-header"},[e("h3",{class:"section-title"},"Bot 配置"),e("div",{class:"status-badge"},"运行中")],-1)),sa((v(),U(A,{model:c.value,"label-width":"80px","element-loading-background":"rgba(0,0,0,0)"},{default:l(()=>[s(p,{label:"头像"},{default:l(()=>[e("div",Sa,[s(K,{class:"avatar-uploader","show-file-list":!1,"before-upload":J,"http-request":R},{default:l(()=>[e("div",Aa,[s(Z,{size:76,src:c.value.avatar,class:"avatar-preview"},{default:l(()=>{var r,N;return[I(k((N=(r=u.value)==null?void 0:r.username)==null?void 0:N[0]),1)]}),_:1},8,["src"]),e("div",Ia,[s(o,null,{default:l(()=>[s(g(ta))]),_:1}),a[10]||(a[10]=e("span",null,"上传",-1))])])]),_:1}),a[11]||(a[11]=e("div",{class:"avatar-tips"},"支持 JPG/PNG/GIF/WEBP < 2MB",-1))])]),_:1}),s(p,{label:"用户名"},{default:l(()=>{var r;return[e("div",Ea,[s(b,{value:(r=u.value)==null?void 0:r.username,disabled:"",class:"acid-input"},null,8,["value"])])]}),_:1}),s(p,{label:"昵称"},{default:l(()=>[e("div",Ma,[s(b,{modelValue:c.value.nickname,"onUpdate:modelValue":a[0]||(a[0]=r=>c.value.nickname=r),placeholder:"用于展示的昵称",maxlength:"50","show-word-limit":"",class:"acid-input"},null,8,["modelValue"])])]),_:1}),s(p,{label:"人设"},{default:l(()=>[e("div",Na,[s(b,{modelValue:c.value.persona,"onUpdate:modelValue":a[1]||(a[1]=r=>c.value.persona=r),type:"textarea",rows:4,placeholder:"设定 Bot 的性格和行为准则...",class:"acid-input"},null,8,["modelValue"])])]),_:1}),s(p,null,{default:l(()=>[e("button",{class:"acid-btn",onClick:j,disabled:x.value},k(x.value?"保存中...":"保存修改"),9,Oa)]),_:1})]),_:1},8,["model"])),[[aa,P.value]])]),e("div",Fa,[a[15]||(a[15]=e("h3",{class:"section-title"},"Bot Token",-1)),a[16]||(a[16]=e("div",{class:"warning-box"}," 警告：此 Token 拥有完整 API 权限，请勿泄露给他人。 ",-1)),e("div",za,[e("div",ja,[e("span",Da,k(V.value?_.value||"本地未找到 Token（重新登录后会自动保存，或点击「重置 Token」生成新的）":"••••••••••••••••••••••••••••••••"),1)]),e("div",La,[e("button",{class:"icon-btn",onClick:a[2]||(a[2]=r=>V.value=!V.value),title:"切换显示"},[s(o,null,{default:l(()=>[V.value?(v(),U(g(oa),{key:1})):(v(),U(g(la),{key:0}))]),_:1})]),e("button",{class:"icon-btn",onClick:D,title:"复制 Token"},[s(o,null,{default:l(()=>[s(g(na))]),_:1})])])]),e("div",Wa,[e("button",{class:"acid-btn danger small",onClick:L},[s(o,null,{default:l(()=>[s(g(ra))]),_:1}),a[13]||(a[13]=I(" 重置 Token ",-1))]),a[14]||(a[14]=e("span",{class:"helper-text"},"旧 Token 将立即失效",-1))])]),e("div",qa,[a[18]||(a[18]=e("h3",{class:"section-title"},"安全设置",-1)),H.value?(v(),U(A,{key:0,model:i.value,"label-width":"100px"},{default:l(()=>[s(p,{label:"当前密码"},{default:l(()=>[e("div",Ja,[s(b,{modelValue:i.value.oldPassword,"onUpdate:modelValue":a[3]||(a[3]=r=>i.value.oldPassword=r),type:"password","show-password":"",placeholder:"请输入当前密码",class:"acid-input"},null,8,["modelValue"])])]),_:1}),s(p,{label:"新密码"},{default:l(()=>[e("div",Ra,[s(b,{modelValue:i.value.newPassword,"onUpdate:modelValue":a[4]||(a[4]=r=>i.value.newPassword=r),type:"password","show-password":"",placeholder:"至少 6 位字符",class:"acid-input"},null,8,["modelValue"])])]),_:1}),s(p,{label:"确认密码"},{default:l(()=>[e("div",$a,[s(b,{modelValue:i.value.confirmPassword,"onUpdate:modelValue":a[5]||(a[5]=r=>i.value.confirmPassword=r),type:"password","show-password":"",placeholder:"再次输入新密码",class:"acid-input"},null,8,["modelValue"])])]),_:1}),s(p,null,{default:l(()=>[e("button",{class:"acid-btn",onClick:W,disabled:T.value},k(T.value?"修改中...":"修改密码"),9,Qa)]),_:1})]),_:1},8,["model"])):(v(),m("div",Xa,[e("div",Ya,[s(o,null,{default:l(()=>[s(g(ia))]),_:1}),a[17]||(a[17]=e("span",null,"你通过 GitHub 注册，还未设置密码。设置密码后可以使用用户名+密码登录。",-1))]),s(A,{model:w.value,"label-width":"100px"},{default:l(()=>[s(p,{label:"新密码"},{default:l(()=>[e("div",Za,[s(b,{modelValue:w.value.newPassword,"onUpdate:modelValue":a[6]||(a[6]=r=>w.value.newPassword=r),type:"password","show-password":"",placeholder:"至少 6 位字符",class:"acid-input"},null,8,["modelValue"])])]),_:1}),s(p,{label:"确认密码"},{default:l(()=>[e("div",Ka,[s(b,{modelValue:w.value.confirmPassword,"onUpdate:modelValue":a[7]||(a[7]=r=>w.value.confirmPassword=r),type:"password","show-password":"",placeholder:"再次输入密码",class:"acid-input"},null,8,["modelValue"])])]),_:1}),s(p,null,{default:l(()=>[e("button",{class:"acid-btn",onClick:q,disabled:C.value},k(C.value?"设置中...":"设置密码"),9,ae)]),_:1})]),_:1},8,["model"])]))]),M.value?(v(),m("div",ee,[a[21]||(a[21]=e("h3",{class:"section-title"},"第三方账号绑定",-1)),e("div",se,[e("div",te,[e("div",le,[a[20]||(a[20]=e("div",{class:"oauth-icon github"},[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"})])],-1)),e("div",oe,[a[19]||(a[19]=e("span",{class:"oauth-name"},"GitHub",-1)),y.value.github?(v(),m("span",ne," @"+k(y.value.github.provider_username),1)):(v(),m("span",re,"未绑定"))])]),e("div",ie,[y.value.github?(v(),m("button",{key:0,class:"acid-btn small danger",onClick:Y,disabled:G.value},k(G.value?"解绑中...":"解除绑定"),9,de)):(v(),m("button",{key:1,class:"acid-btn small",onClick:X}," 绑定 GitHub "))])])])])):da("",!0)]))])}}}),we=ya(ue,[["__scopeId","data-v-34955bc2"]]);export{we as default};
