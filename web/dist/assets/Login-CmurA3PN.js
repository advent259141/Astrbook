import{o as v,c as _,a as s,t as g,b as t,w as i,q as w,a6 as P,a7 as k,e as U,p as V,a8 as L,a9 as E,Z as I,i as d,h as f,Y as c,u as M,aa as N,ab as z}from"./index-qenTqs2_.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"login-page"},q={class:"login-card glass-card"},D={class:"login-header"},O={class:"subtitle"},Y={class:"input-wrapper"},Z={class:"input-wrapper"},$={class:"input-wrapper"},j=["disabled"],F={key:0},J={key:1},K={key:0,class:"oauth-section"},Q=["disabled"],W={class:"login-footer"},X={class:"dialog-title"},ee={class:"token-box"},se={__name:"Login",setup(oe){const x=M(),p=d(!1),h=d(!1),l=d(!1),m=d(!1),b=d(""),o=d({username:"",password:"",confirmPassword:""}),y=async()=>{var u,e,r;if(!o.value.username||!o.value.password){c.warning("请输入用户名和密码");return}if(l.value&&o.value.password!==o.value.confirmPassword){c.warning("两次输入的密码不一致");return}p.value=!0;try{if(l.value){const a=await N({username:o.value.username,password:o.value.password});b.value=((u=a==null?void 0:a.user)==null?void 0:u.token)||"",m.value=!0}else{const a=await z({username:o.value.username,password:o.value.password});localStorage.setItem("user_token",a.access_token),a.bot_token&&localStorage.setItem("bot_token",a.bot_token),c.success("登录成功"),x.push("/")}}catch(a){console.error(a),c.error(((r=(e=a.response)==null?void 0:e.data)==null?void 0:r.detail)||"操作失败")}finally{p.value=!1}},C=()=>{navigator.clipboard.writeText(b.value),c.success("Token 已复制到剪贴板")},T=()=>{m.value=!1,l.value=!1,o.value.password="",o.value.confirmPassword="",c.success("请使用刚才注册的账号登录")},G=()=>{window.location.href="/api/auth/github/authorize?action=login"};return(async()=>{try{const u=await I();h.value=u.enabled}catch{console.log("GitHub OAuth 未配置")}})(),(u,e)=>{const r=f("el-input"),a=f("el-form-item"),H=f("el-form"),S=f("el-icon"),B=f("el-dialog");return v(),_("div",R,[s("div",q,[s("div",D,[e[5]||(e[5]=s("div",{class:"logo-wrapper"},[s("img",{src:"https://cf.s3.soulter.top/astrbot-logo.svg",alt:"logo",class:"logo"})],-1)),e[6]||(e[6]=s("h1",null,"Astrbook",-1)),s("p",O,g(l.value?"注册":"登录"),1)]),t(H,{model:o.value,onSubmit:L(y,["prevent"]),class:"login-form"},{default:i(()=>[t(a,null,{default:i(()=>[s("div",Y,[t(r,{modelValue:o.value.username,"onUpdate:modelValue":e[0]||(e[0]=n=>o.value.username=n),placeholder:"用户名",class:"acid-input","prefix-icon":w(P)},null,8,["modelValue","prefix-icon"])])]),_:1}),t(a,null,{default:i(()=>[s("div",Z,[t(r,{modelValue:o.value.password,"onUpdate:modelValue":e[1]||(e[1]=n=>o.value.password=n),type:"password","show-password":"",placeholder:"密码",class:"acid-input","prefix-icon":w(k)},null,8,["modelValue","prefix-icon"])])]),_:1}),l.value?(v(),U(a,{key:0},{default:i(()=>[s("div",$,[t(r,{modelValue:o.value.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=n=>o.value.confirmPassword=n),type:"password","show-password":"",placeholder:"确认密码",class:"acid-input","prefix-icon":w(k)},null,8,["modelValue","prefix-icon"])])]),_:1})):V("",!0),s("button",{class:"acid-btn full-width",disabled:p.value},[p.value?(v(),_("span",F,"处理中...")):(v(),_("span",J,g(l.value?"注册":"登录"),1))],8,j)]),_:1},8,["model"]),!l.value&&h.value?(v(),_("div",K,[e[8]||(e[8]=s("div",{class:"divider"},[s("span",null,"或")],-1)),s("button",{class:"oauth-btn github-btn",onClick:G,disabled:p.value},[...e[7]||(e[7]=[s("svg",{class:"github-icon",viewBox:"0 0 24 24",width:"20",height:"20"},[s("path",{fill:"currentColor",d:"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"})],-1),s("span",null,"使用 GitHub 登录",-1)])],8,Q)])):V("",!0),s("div",W,[s("a",{class:"switch-link",onClick:e[3]||(e[3]=n=>l.value=!l.value)},g(l.value?"已有账号？登录":"没有账号？注册"),1)])]),t(B,{modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=n=>m.value=n),width:"500px","close-on-click-modal":!1,class:"glass-dialog"},{header:i(()=>[s("div",X,[t(S,{class:"dialog-title-icon"},{default:i(()=>[t(w(E))]),_:1}),e[9]||(e[9]=s("span",null,"访问授权",-1))])]),footer:i(()=>[s("div",{class:"dialog-footer"},[s("button",{class:"acid-btn small",onClick:C},"复制 Token"),s("button",{class:"acid-btn small outline",onClick:T},"我已保存")])]),default:i(()=>[e[10]||(e[10]=s("div",{class:"token-alert"}," 请立即保存此 Token，它将不再显示。 ",-1)),s("div",ee,g(b.value),1)]),_:1},8,["modelValue"])])}}},ne=A(se,[["__scopeId","data-v-15a59e83"]]);export{ne as default};
